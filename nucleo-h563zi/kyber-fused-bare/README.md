# kyber-fused-bare

This is a simple program that runs the Kyber's Key Encapsulation Mechanism (KEM) functions over the NUCLEO-H563ZI board with default peripheral settings. It includes:

- `printf` retarget for use with USART interface;
- Enabling, configuration and use of the TRNG module for generation of random bytes;
- Kyber KEM functions: (1) keypair generation, (2) encapsulation, and (3) decapsulation.

For the Kyber implementation, we use the sources from the kyber-fuse repo, where all headers and implementation files are 'fused' in just two files:

> https://github.com/hogawa/kyber-fuse

### Notes:

- The sources here are part of a CubeIDE project, however not all the CubeMX and 3rd-party middleware libraries and sources are versioned since they can be auto-generated from the `.ioc` file when creating/loading the project.

### Expected output:

Connect the NUCLEO-H563ZI board, and open the UART terminal:

```
picocom -b 115200 /dev/ttyACM0
```

The output should look like as follows:

```
[TEST] Generate random bytes from TRNG:
rand_bytes = { 0xf2, 0x30, 0x01, 0x76, 0x67, 0x5c, 0x45, 0x14 };
rand_bytes = { 0x09, 0x5c, 0x17, 0x32, 0x48, 0xad, 0x5b, 0x03 };
rand_bytes = { 0xf7, 0xc1, 0xc5, 0x49, 0xbb, 0xa9, 0x35, 0x92 };
rand_bytes = { 0x0b, 0xbb, 0x4a, 0x1d, 0xee, 0xbe, 0x3a, 0xb4 };
rand_bytes = { 0xee, 0xf6, 0x33, 0x0b, 0x8b, 0xef, 0xcf, 0x77 };
rand_bytes = { 0xe0, 0xf8, 0x1c, 0x55, 0xba, 0xee, 0xcf, 0xff };
rand_bytes = { 0x76, 0xd2, 0x9a, 0x4b, 0x15, 0x86, 0x4c, 0xe7 };
rand_bytes = { 0x8d, 0x1d, 0x26, 0x54, 0x96, 0x06, 0x0b, 0x05 };
rand_bytes = { 0xa2, 0xda, 0x5e, 0x03, 0x66, 0xb6, 0xb9, 0x42 };
rand_bytes = { 0x0d, 0xc6, 0xdb, 0x3e, 0x4b, 0x6c, 0x58, 0x2a };

[TEST] Kyber KEM test:
KYBER_K = 3

Alice's private key (2400 bytes) = 0x9e9fbe63bc1b83cfb0418e300a90742ec98c1f22dad328571c9e31e4db9e5a12dfe82b3e098fe03dae0231969d846c0dc8830b09a2e0e632dec5ff84d3f0228d1bd6e721dfdc8d0d4c41d8b1076e69100dc76da6646ef8a43be510d99a0283452ecc3442098d4503557de6158c49e1b17cf762fbad9d7ac81232144ba59db9b8968a4b9f9b1907a085e43f025551a3d2beacef0daa166d331ea8e23d268a452c4874bc10edb23576b5f2fab5c4b03ab2d8b109ef0ce2b41ef97466f25ab83bdcb288278219f53367405729d00398c0655850148565311c32a6717c023398b41bb6596a776ac68785fbf712692eaac4cebcf2da47db68c039ca5bf3775980c76c831dba7ab283174944a3f307391f86871862c6c966f9156ed3821389a541cb9f613c1fcaca2306a6606d242d46479124cad055b9991376bb15e50eb9b7b597b70839a835c3b8534b4913a765af8d392d5374f7a67107559752b0654580b4b454f29f898a34c204226fd42264621e9f6d005ed65329644f793104b9c2052c012577587e3645cd9183575972f10dc420757b14b86aafae67ff379b75a511a2a365520863ed1358bb83561b1102864159d9af887f0361b54f52b72a109888f676b7978c15163755ec5d5a0bd64520df43941e6149e98c762962c3e8b2d01288098c7a52e60226d74fda5b53a0a67d537398c3b09e757e38c63d616a2086b17027430ea157afaae1c0b127696454f70c29f93e56786364c2520bec3c56e48082d30561ddb1a32186cca37789c0a6205e273c3d6462653c8cc7a22cb3a3fc0b7f1cec70915b9018c7195b136b070c2d6cb164c6c602f39d21902cad37b51e11d9b0114784f88566567f754101017c676613935979cd8585387696162e504a1be43c490a6717a78f24155e56153bb4729620c6ca8d433da037592010ab1617d95cb5cf62b3a66f28d278e48eb435a36140252aaa505bd740644bc41061b96251cfcfa01eacea7451d6ce97b9826aa8355ccc62541855ab27a0ce86d26abb290cc4df3c2c322925f06323e55140ae984be4a1fafa4a0c7e7e52e28200d78d45bc717a489f87593e19002a34433cf4650d38e872510e756b452d4ad6827cf03a34306689e4173b732c528f74694a9819d794f8bd695223736cd0777b8834c0e21e82b95a40ed6055b3b77cf5abb0338f566fa5791c4814e491682ecb12538d81be3429501e91aebd8418bd4a8bc37be059cb42b173f0a203c24f322aa7663c030bc43db3c80408b16249e23001456130ab5ce6ee750255cd18438d92466cc49c3d70c06528ea9781db09405e6e65fea96a7d49929f8c251582e64c51c1fd24442a9bd9c08789d63674ce710c7c4050ac29d4b1517be3bc20ec4c58c529dc8185620f2b419583806101a10b2469af5845c60cd7a255a58aa02a283d117bc2077c5044337819709f282c8472b4cefa2803288704f130ad46a043417e36a390bdb145b7d4c16f28f67ed55779825b1b30461ac0938ac77796a0d0c5908d438452bae048c47ca84e15ad0ff9ac57799e9464e622148d0452a1695be64782941cf9441838634db6189d41606d737814b7ebba09d14d8893a1cba06dc6d13bf0720e044da13b097105f2861a85a6bc3374d7ea37389519072f217a3e0289382241c5311197688b0481c06d25a51a2dabc08dcc908863f3311a1141a85033d11174c4484199e90b9441c34925a9fc20a71c2785f2e828537a281cd2c3446694f11107381a29c90cb4190143e603169a275d9b7a924712b3887c23787f99f82031628d08c9e0ae6930afd2a3c956e1799144997bd926d2d451db33a7142a4b47b4b97b1fc6f87e5e66587aa5544ac8a4131c20a9c5828fe66f8b010a5835d63325a74251c865d9284f4b54c45877673bbd0a909b2b17de17e2665e5d005ab9b31a538115746a8ee081bea51838c6578f492610d0240839fc092009765a91ce4176329713caa05298e57154267f34485369d3c0308cea6f5a7c0750b7cfa53780e1e2c671de9085d04c90da3bc787b723648ad96ab997288712c96f61728cb1f51173f5139c49572b0898ac49083b5618f7efb0d7fd76aa67aa021a41f7cb1068a5b80ce62522f429992c98174d1a608830ebdc89475486f9392fb8092556a6c3e13381049c42d6e43e3b2f7328ea684b6394b9cfa3dcd214b4bc116736582cc3197c326294ec5ff74069f43d8d5c71545220aa73743beaa4b7f029bbb027bbf30f6939d7cbe4c5ad697a7debe4baa4dd7de159713b364c39b906ec475e452ac9e56f0ae0ba2ce024b050d7adbd00817964a9222dbb793f68f9868590e99044bf2eba282cb54d9ac23f677b0d24c9f66b07a18df7b768d71d1293ce15587e3827a088bc0d0642b6585b48877c7c7b801375771ab4f2854040bb584388afa5e52c344b37762d8e13590fe994645c652e93266da65879f52dc634020e3c94b80a46ae56ca5b61b72fc513358573b5283076daf8b6f3cc8290b13027bd82a1130f00d78e315ea8b69a0216c1c72cd515e9d392232674367543a6002b41bc4e4b50cd490e4d25c7ae666f9c82f42160412f80be74ecf630bc9884e2088955c514f7b29a7b810613868f7abe20f588529a4b44b3e456721e9075826788719179013e5ae71fa35b3735dca1f416a42078bc08bc0beb763e94451ef7391411313920a5b22be01170272ae138b2059354636eca126204b8c937582338b5ecbb9a4216eb4b9f206d0338054809602df6607f9911c5c62f80c84124ec77990377bb0281c32325c6225019cca7bada532e02cd83fad2b1d6a2aa73001373b322834488b5d783545791660d2f9334b16a9f64e8e968a5bbc210669a924a3a8b17515b7428dbaa64514033e7ec2b3ad055859d4999547f8af3368c8858d01077129511b95083bba13d584e41570b97fc23041bf57136227eb18e0e5446666b4431ec19086c9057a760765635a3449da30700826c3b7a45914f906eba23813613209f99e203933678cc46cc4a3c0cbc24cee2dc4533f2a434956b674369f78a84802aab4a593f947ba6d0f73e9cfe2f823e05dad338cbc5a2315c1aa9b55da9eca99bfb0834e7c843a24bc3ad20c0b783f5261c36a27d441a47ab4aa2073a0795600afbee2d77ec53c1b8a589ab87a0a89a696f9227119955d050d9990383407610e90ae0a1c775373e523cac495077f6a80fd106bec3d0a701cb57490170721e54228a02f1f942bbeac4b7782ce09f3b49c25abab3cdc0c85c63a389204390a18b3e9194b409459e33cb66b0c83ba5e7b4a4a37b478c56c9561234ed0273cb80c1afaa405b3ea6062cf0902de67c7ce95e936c9f3a3aed6ad81f42177fb01b67a4120a6d00368b6365b0c2734782ac

Alice's public key (1184 bytes) = 0x1bd6e721dfdc8d0d4c41d8b1076e69100dc76da6646ef8a43be510d99a0283452ecc3442098d4503557de6158c49e1b17cf762fbad9d7ac81232144ba59db9b8968a4b9f9b1907a085e43f025551a3d2beacef0daa166d331ea8e23d268a452c4874bc10edb23576b5f2fab5c4b03ab2d8b109ef0ce2b41ef97466f25ab83bdcb288278219f53367405729d00398c0655850148565311c32a6717c023398b41bb6596a776ac68785fbf712692eaac4cebcf2da47db68c039ca5bf3775980c76c831dba7ab283174944a3f307391f86871862c6c966f9156ed3821389a541cb9f613c1fcaca2306a6606d242d46479124cad055b9991376bb15e50eb9b7b597b70839a835c3b8534b4913a765af8d392d5374f7a67107559752b0654580b4b454f29f898a34c204226fd42264621e9f6d005ed65329644f793104b9c2052c012577587e3645cd9183575972f10dc420757b14b86aafae67ff379b75a511a2a365520863ed1358bb83561b1102864159d9af887f0361b54f52b72a109888f676b7978c15163755ec5d5a0bd64520df43941e6149e98c762962c3e8b2d01288098c7a52e60226d74fda5b53a0a67d537398c3b09e757e38c63d616a2086b17027430ea157afaae1c0b127696454f70c29f93e56786364c2520bec3c56e48082d30561ddb1a32186cca37789c0a6205e273c3d6462653c8cc7a22cb3a3fc0b7f1cec70915b9018c7195b136b070c2d6cb164c6c602f39d21902cad37b51e11d9b0114784f88566567f754101017c676613935979cd8585387696162e504a1be43c490a6717a78f24155e56153bb4729620c6ca8d433da037592010ab1617d95cb5cf62b3a66f28d278e48eb435a36140252aaa505bd740644bc41061b96251cfcfa01eacea7451d6ce97b9826aa8355ccc62541855ab27a0ce86d26abb290cc4df3c2c322925f06323e55140ae984be4a1fafa4a0c7e7e52e28200d78d45bc717a489f87593e19002a34433cf4650d38e872510e756b452d4ad6827cf03a34306689e4173b732c528f74694a9819d794f8bd695223736cd0777b8834c0e21e82b95a40ed6055b3b77cf5abb0338f566fa5791c4814e491682ecb12538d81be3429501e91aebd8418bd4a8bc37be059cb42b173f0a203c24f322aa7663c030bc43db3c80408b16249e23001456130ab5ce6ee750255cd18438d92466cc49c3d70c06528ea9781db09405e6e65fea96a7d49929f8c251582e64c51c1fd24442a9bd9c08789d63674ce710c7c4050ac29d4b1517be3bc20ec4c58c529dc8185620f2b419583806101a10b2469af5845c60cd7a255a58aa02a283d117bc2077c5044337819709f282c8472b4cefa2803288704f130ad46a043417e36a390bdb145b7d4c16f28f67ed55779825b1b30461ac0938ac77796a0d0c5908d438452bae048c47ca84e15ad0ff9ac57799e9464e622148d0452a1695be64782941cf9441838634db6189d41606d737814b7ebba09d14d8893a1cba06dc6d13bf0720e044da13b097105f2861a85a6bc3374d7ea37389519072f217a3e0289382241c5311197688b0481c06d25a51a2dabc08dcc908863f3311a1141a85033d11174c4484199e90b9441c34925a9fc20a71c2785f2e828537a281cd2c3446694f11107381a29c90c

Bob's shared secret (32 bytes) = 0x62123fc43f7bc33a124d8c6dd350ce2c8d1cdad966fdbd2b6a7fe37629bb952d

Bob's ciphertext (1088 bytes) = 0x70d78b81d4c8a4ab3a9f2cca656794d5081b4822abb681bfce6e7dc1ab6b1bc711f10b5ad1b6b0e2572dfba0ec316242663538e82056059f3d8cfb6b32992b4aff97e88d92de2d8387d3c65dbec2e9b74b4b5dddf529365cedeeee576b1cbb5290aa1dd5b6f9426cc2a338ec0108a9d001ac4437eb786d8c8964b94ca28b02019c1f0c3a79e5dd5fa43c73c8525be05257d29179109c9faaab3c3c9ea52f11b13d8818500bd9fe6bdbe8fd0a7ea1a3f69d414c4d7ee6385d98ddc0396ea970aa1aa984002f3a8a1ad63b8d4fcd475e37662b66eca0961676ad57ffe58430c120236b7c68a98a3362b7dfbe5fa1b462fe6a528101132b7ea770757530b9d10c7061621bdfa199d691c868d8a338ce5b9f4560e55be40bba1684552d1d8fdd67fc5cade45a9b0a51656fa1060bee0a9a635da4032cf5068d1b1d58bd6386d74742042409ceff4e25be445415a7a634dc50db0d397ca1e0069b81106c4205b7e742d70bc6e95b59caae3e4aeda435bccfce434242fc8f542b090d93d88b5787218383b95f7cfe8d38c5b55699e8dba4f06e592180e5105c0f225ef4b2c2a236e322e40ed873ac5c02b8d7990397e2c1a4140ce26162ab1f19bbabc92c1d1af0f4f5c18ff8bf1e86f8c0af3a506fa673b5981b9e05fb86556bc28fc00a3d95a3814f2f2d9c5094631810d3ef209ce1d8f3b28412c192d908d7ed14596d46cfdbc59d6ce986e1dbeb309527fd71be982424677660e74053541ede150d676afa7c6040f5233afd2a5257f33ec36b046efe8b1d626756635b343b3def1044dc12aa4150e9f653abe106789c42d3eedd1e41aecb0836b98b79d3986cf982b65c52b7a062cc368342a4b96c90ca6718d4cb1c73c55496afbaaf42a86bde41ea0f84847e8f387a31d0767d8e07d95ae5dcd7ab044b1e2b060977f24bc4a50182e8db27a0a5817d08097e004e93b5f48165fb68aafe8b7542bb64433d44dde4b4dfdc67bda6d2361724b3f00410ed82edf8dee1e13bda08fbe6c6f46f506164b035f4b4d811dc913dbd3300923178af51f19f1f3d630db89ec32838878d943c5ab5f99772c94fa94cae87fa04761c52e2628ddd989f023fc66a8f5d7d3015f3c5974cb275039bda6d37a71a4ccaeacc34ef2bc502ff3b631cb4c26a5d51ceff20d7bdf846167233053933f7cde5d59bed57d36a88e44603dffd76fb3900f5a83a961b9b2e64d496710ff97616b92ac6c6a2d3b9dfab99f4b1efaa1aa4ee9b9f0ff8fc06e19819e8a9a833240f62f60ffa6c1254895532844f11a1ae31d89482baaee9e4edc77714f172a919ec17b8baadc6ed9ca9376f14a71f34ac3ec4c1c0b070e85d506c91c7ae70ed58d1b72728b1b8be71a81c75a734214de12c1efc63c532eb7a5e164591e5eee6cef740bed6e32402e9d95fce8d144792394f8a18c5f3e7e936fbda9cfc56106f422db15ffd82aef0f1e9624f835e5dd4f7c054fc6c07ca9a35b1c2dd1a9124f85e367fae3c36234dac5fc20c19f49db811189c83846e5e50a99b4b

Alice's shared secret (32 bytes) = 0x62123fc43f7bc33a124d8c6dd350ce2c8d1cdad966fdbd2b6a7fe37629bb952d

[PASS] Alice and Bob's shared secrets match
```